### 【詳細版】Campus Connect APIエンドポイント仕様

注記（実装との差分）
- 現行実装は Hono ベースで `/api` 配下に実装されています。
- 本書の一部パス例（例: `/encounters` や `/friends`）は、現行では `/api/users/encounters`、`/api/users/friends` のように `/users` 配下にあります。
- いいね取り消し（DELETE）は実装済みです（`/api/users/:userId/like`）。ただし現実装は「マッチ成立後は取り消し不可（ブロックで関係を解消）」となります。
- デバイストークン登録、公開プロフィール取得、ページネーションは今後対応予定です。

#### 1. ユーザー認証 (Authentication)
* **POST `/auth/register`**
    * **利用する場面:** ユーザーがアプリの新規登録画面で、メールアドレス・パスワード・ニックネーム・性別を入力し、「登録」ボタンをタップした時。
    * **必要な理由:** 新しいユーザーアカウントを作成するため。このAPIがサービスの入り口となる。
    * **備考:** 登録成功時には、ユーザー情報と認証トークンを返すことで、登録と同時にログイン状態にすることが望ましい。パスワードは必ずハッシュ化して保存すること。

* **POST `/auth/login`**
    * **利用する場面:** 既存ユーザーがログイン画面でメールアドレスとパスワードを入力し、「ログイン」ボタンをタップした時。
    * **必要な理由:** 登録済みのユーザーを認証し、サービスの利用に必要な認証トークンを発行するため。
    * **備考:** 認証トークンには有効期限を設定し、クライアント側で安全に保管する必要がある。

#### 2. ユーザー情報 (User Profile & Management)
* **GET `/users/me`**
    * **利用する場面:** ユーザーが「マイページ」や「設定」画面を開き、自身のプロフィール情報を確認する時。
    * **必要な理由:** ログイン中のユーザー自身の完全なプロフィール情報（メールアドレス等を含む）を取得するため。
    * **備考:** 必ず認証トークンが必要な、保護されたAPIとすること。

* **PUT `/users/me`**
    * **利用する場面:** ユーザーがプロフィール編集画面で、自己紹介文や趣味などを変更し「保存」をタップした時。
    * **必要な理由:** ユーザーが自身のプロフィール情報を更新できるようにするため。
    * **備考:** 変更があった項目のみをリクエストボディに含めるPATCH形式の動作が効率的。

* **DELETE `/users/me`**
    * **利用する場面:** ユーザーが設定画面などから「アカウント削除」を選択し、最終確認ダイアログで承認した時。
    * **必要な理由:** ユーザー自身がサービスから退会する権利を保障するため。App Storeのガイドラインでも要求される。
    * **備考:** 極めて重要な破壊的処理。関連する全データ（いいね、マッチング等）を完全に削除、または匿名化する必要がある。操作の前にパスワードの再入力を求めるなど、厳重な本人確認が推奨される。

* **PUT `/users/me/device`**
    * **利用する場面:** アプリの起動時やログイン成功時に、バックグラウンドで自動的に実行される。
    * **必要な理由:** マッチング成立時にプッシュ通知を送るため、サーバーが「どのデバイスに通知を送るべきか」を把握する必要があるため。
    * **備考:** クライアントはOSから取得したデバイストークンをこのAPIに送信する。ユーザーが複数デバイスでログインする可能性も考慮すること。

* **GET `/users/{userId}`**
    * **利用する場面:** ユーザーが「友達リスト」から特定の相手を選択したり、マッチング通知をタップしたりした時。
    * **必要な理由:** 他のユーザーのプロフィール情報を画面に表示するため。
    * **備考:** 表示する情報は公開情報（ニックネーム、自己紹介、趣味など）に限定し、メールアドレスなどの個人情報は含めないこと。バックエンド側で、リクエスト元のユーザーが相手のプロフィールを閲覧する権限（＝マッチング済み）を持っているかチェックすることが望ましい。

#### 3. コアアクション (Core Actions)
* **POST `/encounters`**
    * **利用する場面:** アプリがバックグラウンドでBLEスキャンを行い、他のユーザーを検知した瞬間に、継続的に呼び出される。
    * **必要な理由:** アプリの根幹機能である「すれ違い」を記録するため。このログがすべてのマッチングの元になる。
    * **備考:** 最も呼び出し頻度が高くなるAPI。サーバーは高い負荷を効率的に処理できるよう設計する必要がある。

* **POST `/users/{userId}/like`**
    * **利用する場面:** ユーザーが「すれ違い履歴」画面で、気になる相手の「いいね」ボタンをタップした時。
    * **必要な理由:** 相手への関心を記録し、マッチングの第一歩とするため。
    * **備考:** サーバーはこのリクエストを受け取ると「いいね」を記録し、その時点でお互いに「いいね」し合っている状態（相互いいね）になったかをチェックする。

* **DELETE `/users/{userId}/like`**
    * **利用する場面:** ユーザーが間違って押した「いいね」を取り消したい時。UI上で「いいね済み」のボタンを再度タップするなどの操作が考えられる。
    * **必要な理由:** 操作ミスを訂正できるようにし、ユーザー体験を向上させるため。
    * **備考（現実装）:**
      - エンドポイントは `DELETE /api/users/{userId}/like`。
      - 未マッチ状態の「いいね」のみ削除可能。相互いいねでマッチ済みの場合は 409 を返し、ブロック機能の利用を促す。

* **POST `/users/{userId}/block`**
    * **利用する場面:** ユーザーが相手のプロフィール画面などから「ブロック」を選択した時。
    * **必要な理由:** ユーザーの安全と快適性を守るための重要なセーフティ機能。
    * **備考:** サーバー側では、マッチング情報・相互のいいね・マッチング待ち状態をすべて削除し、今後二者がすれ違っても検知対象から除外する、という一連の処理を確実に行う。



#### 4. 一覧取得 (List Retrieval)
* **GET `/encounters`**
    * **利用する場面:** アプリのメイン画面を開き、最近すれ違った人々のリストを表示する時。
    * **必要な理由:** ユーザーが「いいね」を送る相手を探すための、最も基本的な情報を提供するため。
    * **備考:** パフォーマンスのため、必ずページネーション（例: `?page=1&limit=20`）を実装すること。

* **GET `/friends`**
    * **利用する場面:** ユーザーがフッターメニューなどの「友達」タブをタップし、マッチングが成立した相手の一覧を見たい時。
    * **必要な理由:** マッチングした相手との繋がりを永続的に保持し、いつでもプロフィールを確認できるようにするため。
    * **備考:** ページネーションを実装すること。リストで返す各ユーザーの情報は、ニックネームやプロフィール画像URLなど、一覧表示に必要な最小限のデータに留めると通信効率が良い。

* **GET `/blocked-users`**
    * **利用する場面:** ユーザーが設定画面から「ブロックしたユーザー」の管理画面を開いた時。
    * **必要な理由:** 自分が誰をブロックしているかを確認し、ブロック解除の操作を行えるようにするため。
    * **備考:** ページネーションを実装すること。
